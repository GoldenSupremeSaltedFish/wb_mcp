---
description: 微博 MCP 工程的开发规则
globs:
  - "**/*.ts"
  - "**/*.tsx"
alwaysApply: true

rules:

  # 1. 项目结构 & 模块化
  - match: "src/**/*"
    message: "所有业务代码必须放在 src/ 下，禁止 utils 大杂烩，必须按 auth/api/tasks/utils 分类。"
  
  # 2. 配置管理l'k'nlkn
  - match: "src/**/*.ts"
    message: "禁止在代码中写死 access_token 或 cookie，必须从 process.env 读取。"

  # 3. 日志 & 错误处理
  - match: "src/**/*.ts"
    message: "所有外部请求必须用统一的 logger 记录，禁止 console.log。"
  - match: "src/api/**/*.ts"
    message: "调用微博 API 必须实现错误重试（指数退避），禁止裸 fetch。"

  # 4. Agent 接口规范
  - match: "src/tasks/**/*.ts"
    message: "每个 task 必须声明 id、inputSchema、outputSchema、example，保证可被 Agent 学习。"

  # 5. 部署 & 运行
  - match: "package.json"
    message: "必须包含 npm run build:mcp 和 npm run dev 命令，保证轻量运行。"
  
  # 6. 安全策略
  - match: "src/**/*.ts"
    message: "必须实现请求限流，避免触发微博风控。"
  
  # 7. 测试 & 迭代
  - match: "tests/**/*.ts"
    message: "必须对每个关键任务（发微博、查时间线）写单元测试或集成测试。"
---