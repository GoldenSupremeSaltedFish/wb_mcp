# å¾®åšç”Ÿæ´»åŠ©ç† MCP æœåŠ¡

ä¸€ä¸ªåŸºäº Electron å’Œ MCP (Model Context Protocol) çš„**æ™ºèƒ½ç”Ÿæ´»åŠ©ç†å·¥å…·**ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†å¾®åšç¤¾äº¤ç”Ÿæ´»ï¼Œæä¾›è¯„è®ºå›å¤ã€ç‚¹èµäº’åŠ¨ã€å†…å®¹å‘å¸ƒç­‰ç”Ÿæ´»åŠ©ç†æœåŠ¡ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **MCP æœåŠ¡**: æä¾›æ ‡å‡†åŒ–çš„ MCP æ¥å£ï¼Œæ”¯æŒæ™ºèƒ½åŠ©æ‰‹è°ƒç”¨
- **ç”Ÿæ´»åŠ©ç†åŠŸèƒ½**: æ™ºèƒ½è¯„è®ºå›å¤ã€è‡ªåŠ¨ç‚¹èµã€å†…å®¹å‘å¸ƒ
- **å¤šä¼ è¾“æ–¹å¼**: æ”¯æŒ STDIOã€HTTP å’Œ SSE æµå¼ä¼ è¾“
- **æ™ºèƒ½äº¤äº’**: æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼Œè‡ªç„¶æµç•…çš„ç¤¾äº¤äº’åŠ¨
- **é…ç½®æ¨¡æ¿**: å¤šç§ç”¨æˆ·è¡Œä¸ºæ¨¡æ¿ï¼Œä¸€é”®é…ç½®ç”Ÿæ´»åŠ©ç†
- **å®‰å…¨å¯é **: å†…ç½®åæ£€æµ‹æœºåˆ¶ï¼Œä¿æŠ¤ç”¨æˆ·è´¦å·å®‰å…¨
- **æ—¥å¿—ç³»ç»Ÿ**: å®Œæ•´çš„æ“ä½œè®°å½•å’Œé”™è¯¯å¤„ç†
- **è¯·æ±‚é™æµ**: æ™ºèƒ½é™æµæœºåˆ¶ï¼Œé¿å…è§¦å‘å¹³å°é£æ§

## ğŸ“‹ ç”Ÿæ´»åŠ©ç†åŠŸèƒ½

| åŠŸèƒ½åç§° | æè¿° | å‚æ•° |
|---------|------|------|
| `post_weibo` | å‘å¸ƒå¾®åšå†…å®¹ | content, images, location |
| `reply_comment` | æ™ºèƒ½å›å¤è¯„è®º | postId, commentId, reply |
| `like_post` | ç‚¹èµå¾®åš | postId |
| `like_comment` | ç‚¹èµè¯„è®º | commentId |
| `follow_user` | å…³æ³¨ç”¨æˆ· | userId |
| `unfollow_user` | å–æ¶ˆå…³æ³¨ | userId |
| `get_mentions` | è·å–@æˆ‘çš„æ¶ˆæ¯ | limit |
| `get_comments` | è·å–æˆ‘çš„è¯„è®º | limit |
| `get_status` | è·å–åŠ©ç†çŠ¶æ€ | - |

## ğŸ› ï¸ å®‰è£…å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- pnpm (æ¨è) æˆ– npm

### å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install
```

### é…ç½®ç”Ÿæ´»åŠ©ç†

#### 1. å¿«é€Ÿé…ç½®æ¨¡æ¿

```bash
# é€‰æ‹©ç”Ÿæ´»åŠ©ç†æ¨¡å¼
npm run template:setup casual        # æ™®é€šç”¨æˆ·æ¨¡å¼
npm run template:setup professional  # ä¸“ä¸šç”¨æˆ·æ¨¡å¼
npm run template:setup stealth       # éšèº«æ¨¡å¼ï¼ˆæ¨èï¼‰
```

#### 2. é…ç½®å¾®åšè®¤è¯

å¤åˆ¶ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š

```bash
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®å¾®åšè®¤è¯ä¿¡æ¯ï¼š

```env
# å¾®åšè®¤è¯é…ç½®ï¼ˆå¿…éœ€ï¼‰
WEIBO_ACCESS_TOKEN=your_access_token
WEIBO_COOKIE=your_cookie

# ç”Ÿæ´»åŠ©ç†é…ç½®
MCP_SERVER_PORT=3000
MCP_SERVER_HOST=localhost

# æ™ºèƒ½é™æµé…ç½®
REQUEST_RATE_LIMIT=5
REQUEST_INTERVAL_MS=2000
```

### è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼ (TypeScript ç›´æ¥è¿è¡Œ)
pnpm run start:ts

# æ„å»ºå¹¶è¿è¡Œ
pnpm run build
pnpm run start

# å¼€å‘æ¨¡å¼ (ç›‘å¬æ–‡ä»¶å˜åŒ–)
pnpm run dev
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡ŒåŸºç¡€åŠŸèƒ½æµ‹è¯•
npx ts-node tests/basic.test.ts
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
wb_mcp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/           # Electron ä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ renderer/       # å‰ç«¯ç•Œé¢ (å¯é€‰)
â”‚   â”œâ”€â”€ mcpserver/      # MCP æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ tools/          # MCP å·¥å…·å®šä¹‰
â”‚   â”œâ”€â”€ api/            # å¾®åš API å°è£…
â”‚   â”œâ”€â”€ auth/           # è®¤è¯ç›¸å…³
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ index.ts        # ç‹¬ç«‹æ¨¡å¼å…¥å£
â”œâ”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ data/               # æ•°æ®å­˜å‚¨ç›®å½•
â”œâ”€â”€ exports/            # å¯¼å‡ºæ–‡ä»¶ç›®å½•
â””â”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶ç›®å½•
```

## ğŸ”§ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

é¡¹ç›®éµå¾ªä»¥ä¸‹å¼€å‘è§„åˆ™ï¼š

1. **é¡¹ç›®ç»“æ„**: æ‰€æœ‰ä¸šåŠ¡ä»£ç å¿…é¡»æ”¾åœ¨ `src/` ä¸‹ï¼ŒæŒ‰ `auth/api/tools/utils` åˆ†ç±»
2. **é…ç½®ç®¡ç†**: ç¦æ­¢åœ¨ä»£ç ä¸­å†™æ­» access_token æˆ– cookieï¼Œå¿…é¡»ä» `process.env` è¯»å–
3. **æ—¥å¿—è®°å½•**: æ‰€æœ‰å¤–éƒ¨è¯·æ±‚å¿…é¡»ç”¨ç»Ÿä¸€çš„ logger è®°å½•ï¼Œç¦æ­¢ `console.log`
4. **é”™è¯¯å¤„ç†**: è°ƒç”¨å¾®åš API å¿…é¡»å®ç°é”™è¯¯é‡è¯•ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
5. **Agent æ¥å£**: æ¯ä¸ª task å¿…é¡»å£°æ˜ `id`ã€`inputSchema`ã€`outputSchema`ã€`example`
6. **è¯·æ±‚é™æµ**: å¿…é¡»å®ç°è¯·æ±‚é™æµï¼Œé¿å…è§¦å‘å¾®åšé£æ§
7. **æµ‹è¯•è¦†ç›–**: å¿…é¡»å¯¹æ¯ä¸ªå…³é”®ä»»åŠ¡å†™å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•

### æ·»åŠ æ–°å·¥å…·

1. åœ¨ `src/tools/weibo-tools.ts` ä¸­æ·»åŠ å·¥å…·å®šä¹‰
2. å®ç°å¯¹åº”çš„æ‰§è¡Œé€»è¾‘
3. åœ¨ `src/api/weibo-api.ts` ä¸­æ·»åŠ  API è°ƒç”¨
4. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### æ—¥å¿—çº§åˆ«

- `DEBUG`: è°ƒè¯•ä¿¡æ¯
- `INFO`: ä¸€èˆ¬ä¿¡æ¯
- `WARN`: è­¦å‘Šä¿¡æ¯
- `ERROR`: é”™è¯¯ä¿¡æ¯

## ğŸ“Š ç”Ÿæ´»åŠ©ç†ä½¿ç”¨ç¤ºä¾‹

### æ™ºèƒ½ç”Ÿæ´»åŠ©ç†åŠŸèƒ½

#### å‘å¸ƒå¾®åš
```bash
curl -X POST http://localhost:3000/tools/execute \
  -H "Content-Type: application/json" \
  -d '{
    "name": "post_weibo",
    "arguments": {
      "content": "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå¿ƒæƒ…ä¹Ÿå¾ˆæ£’ï¼",
      "images": ["path/to/image.jpg"],
      "location": "åŒ—äº¬å¸‚æœé˜³åŒº"
    }
  }'
```

#### æ™ºèƒ½å›å¤è¯„è®º
```bash
curl -X POST http://localhost:3000/tools/execute \
  -H "Content-Type: application/json" \
  -d '{
    "name": "reply_comment",
    "arguments": {
      "postId": "1234567890",
      "commentId": "9876543210",
      "reply": "è°¢è°¢ä½ çš„è¯„è®ºï¼Œæˆ‘ä¹Ÿè¿™ä¹ˆè®¤ä¸ºï¼"
    }
  }'
```

#### ç‚¹èµäº’åŠ¨
```bash
# ç‚¹èµå¾®åš
curl -X POST http://localhost:3000/tools/execute \
  -H "Content-Type: application/json" \
  -d '{
    "name": "like_post",
    "arguments": {
      "postId": "1234567890"
    }
  }'

# ç‚¹èµè¯„è®º
curl -X POST http://localhost:3000/tools/execute \
  -H "Content-Type: application/json" \
  -d '{
    "name": "like_comment",
    "arguments": {
      "commentId": "9876543210"
    }
  }'
```

#### è·å–äº’åŠ¨æ¶ˆæ¯
```bash
# è·å–@æˆ‘çš„æ¶ˆæ¯
curl -X POST http://localhost:3000/tools/execute \
  -H "Content-Type: application/json" \
  -d '{
    "name": "get_mentions",
    "arguments": {
      "limit": 10
    }
  }'
```

### é€šè¿‡ MCP å®¢æˆ·ç«¯è°ƒç”¨

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "post_weibo",
    "arguments": {
      "content": "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œå¿ƒæƒ…ä¹Ÿå¾ˆæ£’ï¼",
      "images": ["path/to/image.jpg"],
      "location": "åŒ—äº¬å¸‚æœé˜³åŒº"
    }
  }
}
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **è®¤è¯é…ç½®**: ä½¿ç”¨å‰éœ€è¦é…ç½®æœ‰æ•ˆçš„å¾®åš access_token æˆ– cookie
2. **æ™ºèƒ½é™æµ**: é»˜è®¤é™åˆ¶ä¸ºæ¯2ç§’5æ¬¡è¯·æ±‚ï¼Œä¿æŠ¤è´¦å·å®‰å…¨
3. **è¡Œä¸ºæ¨¡æ‹Ÿ**: ç”Ÿæ´»åŠ©ç†ä¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸ºï¼ŒåŒ…æ‹¬éšæœºç­‰å¾…ã€é¼ æ ‡ç§»åŠ¨ç­‰
4. **å®‰å…¨ä¿æŠ¤**: å†…ç½®åæ£€æµ‹æœºåˆ¶ï¼Œé¿å…è¢«å¹³å°è¯†åˆ«ä¸ºæœºå™¨äºº
5. **æ—¥å¿—è®°å½•**: æ‰€æœ‰æ“ä½œéƒ½ä¼šè®°å½•åœ¨ `logs/wb_mcp.log` ä¸­

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## âš–ï¸ License & Usage

æœ¬é¡¹ç›®éµå¾ª **CC BY-NC 4.0 åè®®**ï¼š
- âœ… å…è®¸ä¸ªäººå­¦ä¹ ã€ç ”ç©¶å’Œéå•†ä¸šç”¨é€”
- âœ… å…è®¸ä¿®æ”¹å’Œåˆ†å‘ï¼ˆå¿…é¡»ä¿ç•™ç½²åå’Œåè®®ï¼‰
- âŒ ä¸¥ç¦ä»»ä½•å•†ä¸šç”¨é€”ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºé”€å”®ã€å¹¿å‘Šã€ä»£è¿è¥ï¼‰
- âŒ ä¸¥ç¦ç”¨äºè¿åç›®æ ‡å¹³å°æœåŠ¡æ¡æ¬¾çš„è¡Œä¸º

ä½¿ç”¨æœ¬é¡¹ç›®æ‰€é€ æˆçš„é£é™©å’Œåæœï¼Œç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚

## ğŸ†˜ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `logs/wb_mcp.log`
2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ç½‘ç»œè¿æ¥å’Œå¾®åšè®¤è¯çŠ¶æ€
4. æäº¤ Issue æè¿°é—®é¢˜

---

**é‡è¦å£°æ˜**: æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**æ™ºèƒ½ç”Ÿæ´»åŠ©ç†å·¥å…·**ï¼Œä»…ç”¨äºä¸ªäººç¤¾äº¤ç”Ÿæ´»ç®¡ç†ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç®¡ç†å¾®åšäº’åŠ¨ã€‚ä¸¥ç¦ç”¨äºä»»ä½•å•†ä¸šç”¨é€”æˆ–è¿åç›®æ ‡å¹³å°æœåŠ¡æ¡æ¬¾çš„è¡Œä¸ºã€‚è¯·éµå®ˆå¾®åšçš„ä½¿ç”¨æ¡æ¬¾å’Œç›¸å…³æ³•å¾‹æ³•è§„ã€‚